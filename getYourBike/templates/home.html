{% extends "base.html" %}
{% load staticfiles %}
{% block content %}

    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript">
        var carte;  
        var tabMarqueurs = new Array();
        var infowindow = new google.maps.InfoWindow();
        function attachContent(marker, data) {  
                google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent(marker.getTitle());
                infowindow.open(marker.get('map'), marker);
                });
                
                
        }
        
        function initialiser() {
            var latlng = new google.maps.LatLng(45.750000,  4.850000);
            var infowindow = new google.maps.InfoWindow({
                content: 'Infobulle'
            });
            //objet contenant des propriétés avec des identificateurs prédéfinis dans Google Maps permettant
            //de définir des options d'affichage de notre carte
            var options = {
                center: latlng,
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            carte = new google.maps.Map(document.getElementById("carte"), options);     
            $.ajax({
                type: "POST",
                url: "/search/stations",
                traditional: true,
                success: function(data) {
                     for(var key in data){
						
                        var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(data[key].stationLat, data[key].stationLong),//coordonnée de la position du clic sur la carte 
                        title: data[key].stationRegion + "<br>" + data[key].stationNum + " - " + data[key].stationName,
                        icon: "static/velo2.png",
                        map: carte//la carte sur laquelle le marqueur doit être affiché
                        });
                        
                        attachContent(marker, data[key]);
                        tabMarqueurs.push(marker); 
                    }
                    
                }
            });
            
        }
                                            
    </script>


            {{result}}

            <div id="carte" style="width:90%; height:200px;"></div>
            <form action="{% url "search.views.home" %}" method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Submit" />
            </form>
           <!-- Table des résultats de la recherche -->
            <p>Les r&eacute;sultats affich&eacute;s ici sont statiques : </p>
            <table align="center" border="1" width="80%">
                <tr>
                    <td>
                        <b>Nom de la station</b>
                    </td>
                    <td>
                        <b>Nombre de v&eacute;lo</b>
                    </td>
                </tr>
                <tr>
                    <td>
                        Charpennes
                    </td>
                    <td>
                        2
                    </td>
                </tr>
                <tr>
                    <td>
                        Republique
                    </td>
                    <td>
                        5
                    </td>
                </tr>
                <tr>
                    <td>
                        Lyc&eacute;e du Parc
                    </td>
                    <td>
                        10
                    </td>
                </tr>
                <tr>
                    <td>
                        Bellecombe
                    </td>
                    <td>
                        8
                    </td>
                </tr>
            </table>
        </div>

{% endblock %}